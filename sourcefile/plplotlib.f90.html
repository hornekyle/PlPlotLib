<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="PlPlot wrapper module">
    
    <meta name="author" content="Chris MacMackin" >
    <link rel="icon" href="../favicon.png">

    <title>plplotlib.f90 &ndash; PlPlotLib</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">PlPlotLib </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li><a href='../page/index.html'>Module Usage</a></li>
				
                
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
				
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
								
				
            <li><a href="../lists/programs.html">Programs</a></li>
				
          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>plplotlib.f90
    <small>Source File</small>
    
    </h1>
	 
<div class="row">
<div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
    <li><i class="fa fa-code"></i><a href="../src/plplotlib.f90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li class="active">plplotlib.f90</li>
  </ol>
</div>
</div>
</div>
    
  </div>
  <div class="row">
    <div class="col-lg-3">
    
  
  
  
  
  
  
  <div class="panel panel-primary">
    <div class="panel-heading text-left"><h3 class="panel-title">Modules</h3></div>
    <div class="list-group">
      
      <a class="list-group-item" href="../module/plplotlib_mod.html">plplotlib_mod</a>
      
    </div>
  </div>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <div class="panel panel-primary">
    <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
    <div class="list-group">
      <a class="list-group-item" href="../sourcefile/plplotlib.f90.html#src">plplotlib.f90</a>
    </div>
  </div>
  
  <hr>
  
  <div class="panel panel-default">
    <div class="panel-heading text-left"><h3 class="panel-title">All Source Files</h3></div>
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/basic.f90.html">basic.f90</a>
      
      <a class="list-group-item" href="../sourcefile/examples.f90.html">examples.f90</a>
      
      <a class="list-group-item" href="../sourcefile/kinds.f90.html">kinds.f90</a>
      
      <a class="list-group-item" href="../sourcefile/main.f90.html">main.f90</a>
      
      <a class="list-group-item" href="../sourcefile/plplotlib.f90.html">plplotlib.f90</a>
      
    </div>
  </div>
  
  
    </div>
    <div class="col-lg-9" id='text'>
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span class="k">module </span><span class="n">plplotlib_mod</span>
	<span class="c">!! Wrapper module for plplot to give it a more matplotlib like personality</span>
	<span class="k">use </span><span class="n">kinds_mod</span>
	<span class="k">use </span><span class="n">plplot</span>
	<span class="k">implicit none</span>
<span class="k">	private</span>
<span class="k">	</span>
<span class="k">	</span><span class="kt">integer</span><span class="p">,</span><span class="k">parameter</span><span class="kd">::</span><span class="n">pp</span> <span class="o">=</span> <span class="n">plflt</span>
	
	<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">parameter</span><span class="kd">::</span><span class="n">default_dev</span> <span class="o">=</span> <span class="s1">&#39;qtwidget&#39;</span>
		<span class="c">!! Default output device</span>
	
	<span class="c">!=================!</span>
	<span class="c">!= Library State =!</span>
	<span class="c">!=================!</span>
	
	<span class="kt">logical</span><span class="kd">::</span><span class="n">isSetup</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
		<span class="c">!! Flag for library setup status</span>
	<span class="kt">logical</span><span class="kd">::</span><span class="n">didShow</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
		<span class="c">!! Flag for library display status</span>
	<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">fontScale</span> <span class="o">=</span> <span class="mf">1.0_pp</span>
		<span class="c">!! Font scale factor to resetPen</span>
	<span class="kt">logical</span><span class="kd">::</span><span class="n">blackOnWhite</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
		<span class="c">!! Reverse black and white</span>
	<span class="kt">logical</span><span class="kd">::</span><span class="n">transparentBackground</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
		<span class="c">!! Transparent background</span>
	
	<span class="c">!==============!</span>
	<span class="c">!= Interfaces =!</span>
	<span class="c">!==============!</span>
	
	<span class="k">interface </span><span class="n">mixval</span>
		<span class="c">!! Return a 2-vector comprising the minimum and maximum values of an array</span>
		<span class="k">module procedure </span><span class="n">mixval_1</span>
		<span class="k">module procedure </span><span class="n">mixval_2</span>
		<span class="k">module procedure </span><span class="n">mixval_3</span>
	<span class="k">end interface</span>
<span class="k">	</span>
<span class="k">	interface </span><span class="n">localize</span>
		<span class="k">module procedure </span><span class="n">localize_1</span>
		<span class="k">module procedure </span><span class="n">localize_2</span>
	<span class="k">end interface</span>
	
	<span class="c">!===========!</span>
	<span class="c">!= Exports =!</span>
	<span class="c">!===========!</span>
	
	<span class="k">public</span><span class="kd">::</span><span class="n">setup</span><span class="p">,</span><span class="n">show</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">figure</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">subplot</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">xylim</span><span class="p">,</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="p">,</span><span class="n">xyzlim</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">labels</span><span class="p">,</span><span class="n">xlabel</span><span class="p">,</span><span class="n">ylabel</span><span class="p">,</span><span class="n">title</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">ticks</span><span class="p">,</span><span class="n">xticks</span><span class="p">,</span><span class="n">yticks</span><span class="p">,</span><span class="n">box</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">legend</span>
	
	<span class="k">public</span><span class="kd">::</span><span class="n">mixval</span><span class="p">,</span><span class="n">linspace</span><span class="p">,</span><span class="n">binData</span>
	
	<span class="k">public</span><span class="kd">::</span><span class="n">plot</span><span class="p">,</span><span class="n">plot3</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">scatter</span><span class="p">,</span><span class="n">errorbar</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">contour</span><span class="p">,</span><span class="n">contourf</span><span class="p">,</span><span class="n">colorbar</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">bar</span><span class="p">,</span><span class="n">barh</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">hist</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">fillBetween</span><span class="p">,</span><span class="n">fillBetweenx</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">quiver</span>
	<span class="k">public</span><span class="kd">::</span><span class="n">surface</span><span class="p">,</span><span class="n">wireframe</span>
	
<span class="k">contains</span>

	<span class="c">!===================!</span>
	<span class="c">!= Helper Routines =!</span>
	<span class="c">!===================!</span>

	<span class="k">function </span><span class="n">mixval_1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
		<span class="c">!! Return [hi,low] for an array</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! Array to find extrema in</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="kd">::</span><span class="n">b</span>
		
		<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
	<span class="k">end function </span><span class="n">mixval_1</span>

	<span class="k">function </span><span class="n">mixval_2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
		<span class="c">!! Return [hi,low] for an array</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! Array to find extrema in</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="kd">::</span><span class="n">b</span>
		
		<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
	<span class="k">end function </span><span class="n">mixval_2</span>

	<span class="k">function </span><span class="n">mixval_3</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
		<span class="c">!! Return [hi,low] for an array</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! Array to find extrema in</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="kd">::</span><span class="n">b</span>
		
		<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="nb">minval</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
	<span class="k">end function </span><span class="n">mixval_3</span>

	<span class="k">function </span><span class="n">linspace</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
		<span class="c">!! Return an array of evenly-spaced values</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">l</span>
			<span class="c">!! Low-bound for values</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">h</span>
			<span class="c">!! High-bound for values</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">N</span>
			<span class="c">!! Number of values (default 20)</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">o</span>
		
		<span class="kt">integer</span><span class="kd">::</span><span class="n">Nl</span><span class="p">,</span><span class="n">i</span>
		
		<span class="n">Nl</span> <span class="o">=</span> <span class="mi">20</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="n">Nl</span> <span class="o">=</span> <span class="n">N</span>
		
		<span class="n">o</span> <span class="o">=</span> <span class="p">[(</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">wp</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">Nl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">wp</span><span class="p">)</span><span class="o">+</span><span class="n">l</span> <span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span> <span class="p">,</span> <span class="n">Nl</span> <span class="p">)]</span>
	<span class="k">end function </span><span class="n">linspace</span>

	<span class="k">function </span><span class="n">startsWith</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
		<span class="c">!! Test if text starts with str</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">text</span>
			<span class="c">!! Text to search</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">str</span>
			<span class="c">!! String to look for</span>
		<span class="kt">logical</span><span class="kd">::</span><span class="n">o</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">k</span>
		
		<span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
		<span class="n">o</span> <span class="o">=</span> <span class="n">text</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="n">str</span>
	<span class="k">end function </span><span class="n">startsWith</span>

	<span class="k">function </span><span class="n">endsWith</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
		<span class="c">!! Test if text ends with str</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">text</span>
			<span class="c">!! Text to search</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">str</span>
			<span class="c">!! String to look for</span>
		<span class="kt">logical</span><span class="kd">::</span><span class="n">o</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">k</span>
		
		<span class="n">k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
		<span class="n">o</span> <span class="o">=</span> <span class="n">text</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="n">str</span>
	<span class="k">end function </span><span class="n">endsWith</span>

	<span class="k">function </span><span class="n">binData</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">db</span><span class="p">,</span><span class="n">normalize</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
		<span class="c">!! Count data in each bin</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">d</span>
			<span class="c">!! Data for binning</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">N</span>
			<span class="c">!! Number of bins</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">db</span>
			<span class="c">!! Boundaries of bin range</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">normalize</span>
			<span class="c">!! Normalization type (1=sum, 2=bin size, 3=maxval)</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">o</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">b</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">Nl</span><span class="p">,</span><span class="n">k</span>
		
		<span class="n">Nl</span> <span class="o">=</span> <span class="mi">10</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="n">Nl</span> <span class="o">=</span> <span class="n">N</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">db</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			</span><span class="n">b</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="n">db</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">db</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">Nl</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">else</span>
<span class="k">			</span><span class="n">b</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="nb">minval</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">-</span><span class="nb">epsilon</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">+</span><span class="nb">epsilon</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">),</span><span class="n">Nl</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		allocate</span><span class="p">(</span><span class="n">o</span><span class="p">(</span><span class="n">Nl</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
		<span class="n">o</span><span class="p">(:,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">Nl</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="n">Nl</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mf">2.0_wp</span>
		
		<span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Nl</span>
			<span class="n">o</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="n">d</span><span class="o">&gt;=</span><span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">d</span><span class="o">&lt;=</span><span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span><span class="n">wp</span><span class="p">)</span>
		<span class="k">end do</span>
<span class="k">		</span>
<span class="k">		if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">normalize</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			select case</span><span class="p">(</span><span class="n">normalize</span><span class="p">)</span>
			<span class="k">case</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">o</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">o</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">o</span><span class="p">(:,</span><span class="mi">2</span><span class="p">))</span>
			<span class="k">case</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
				<span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Nl</span>
					<span class="n">o</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">o</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">b</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
				<span class="k">end do</span>
<span class="k">			case</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
				<span class="n">o</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">o</span><span class="p">(:,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">maxval</span><span class="p">(</span><span class="n">o</span><span class="p">(:,</span><span class="mi">2</span><span class="p">))</span>
			<span class="k">end select</span>
<span class="k">		end if</span>
<span class="k">	end function </span><span class="n">binData</span>

	<span class="k">function </span><span class="n">localize_1</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">A</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">o</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">N</span><span class="p">,</span><span class="n">k</span>
		
		<span class="n">N</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
		<span class="k">allocate</span><span class="p">(</span><span class="n">o</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
		<span class="k">forall</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="p">)</span> <span class="n">o</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">pp</span><span class="p">)</span>
	<span class="k">end function </span><span class="n">localize_1</span>

	<span class="k">function </span><span class="n">localize_2</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">A</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">o</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span>
		
		<span class="n">N</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">M</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
		<span class="k">allocate</span><span class="p">(</span><span class="n">o</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">M</span><span class="p">))</span>
		<span class="k">forall</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">M</span><span class="p">)</span> <span class="n">o</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">A</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">pp</span><span class="p">)</span>
	<span class="k">end function </span><span class="n">localize_2</span>

	<span class="c">!============================!</span>
	<span class="c">!= Axes and Figure Routines =!</span>
	<span class="c">!============================!</span>

	<span class="k">subroutine </span><span class="n">figure</span>
		<span class="c">!! Create a new figure</span>
		<span class="kt">logical</span><span class="p">,</span><span class="k">save</span><span class="kd">::</span><span class="n">isFirst</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
		
		<span class="k">if</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">isSetup</span><span class="p">)</span> <span class="k">call </span><span class="n">setup</span><span class="p">()</span>
		
		<span class="k">if</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">isFirst</span><span class="p">)</span> <span class="k">then</span>
<span class="k">			call </span><span class="n">pleop</span><span class="p">()</span>
		<span class="k">else</span>
<span class="k">			</span><span class="n">isFirst</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		call </span><span class="n">plbop</span><span class="p">()</span>
		<span class="k">call </span><span class="n">plssub</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">call </span><span class="n">pladv</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">figure</span>

	<span class="k">subroutine </span><span class="n">subplot</span><span class="p">(</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">aspect</span><span class="p">,</span><span class="n">is3d</span><span class="p">)</span>
		<span class="c">!! Create a set of axes on a figure</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">nx</span>
			<span class="c">!! Number of subplot columns</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">ny</span>
			<span class="c">!! Number of subplot rows</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">i</span>
			<span class="c">!! Subplot to use</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">aspect</span>
			<span class="c">!! Aspect ratio of the axes</span>
		<span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">is3d</span>
		
		<span class="kt">logical</span><span class="kd">::</span><span class="n">is3dl</span>
		
		<span class="k">call </span><span class="n">plssub</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span>
		<span class="k">call </span><span class="n">pladv</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
		
		<span class="n">is3dl</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">is3d</span><span class="p">))</span> <span class="n">is3dl</span> <span class="o">=</span> <span class="n">is3d</span>
		
		<span class="k">if</span><span class="p">(</span><span class="n">is3dl</span><span class="p">)</span> <span class="k">then</span>
<span class="k">			call </span><span class="n">plvpor</span><span class="p">(</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="mf">1.0_pp</span><span class="p">,</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="mf">1.0_pp</span><span class="p">)</span>
		<span class="k">else</span>
<span class="k">			if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">aspect</span><span class="p">))</span> <span class="k">then</span>
<span class="k">				call </span><span class="n">plvasp</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">aspect</span><span class="p">,</span><span class="n">pp</span><span class="p">))</span>
			<span class="k">else</span>
<span class="k">				call </span><span class="n">plvsta</span><span class="p">()</span>
			<span class="k">end if</span>
<span class="k">		end if</span>
<span class="k">		</span>
<span class="k">		call </span><span class="n">defaultLim</span>
	<span class="k">end subroutine </span><span class="n">subplot</span>

	<span class="k">subroutine </span><span class="n">defaultLim</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">parameter</span><span class="kd">::</span><span class="n">eps</span> <span class="o">=</span> <span class="nb">epsilon</span><span class="p">(</span><span class="mf">1.0_pp</span><span class="p">)</span>
		
		<span class="k">call </span><span class="n">plwind</span><span class="p">(</span><span class="o">-</span><span class="n">eps</span><span class="p">,</span><span class="n">eps</span><span class="p">,</span><span class="o">-</span><span class="n">eps</span><span class="p">,</span><span class="n">eps</span><span class="p">)</span>
	<span class="k">end subroutine </span><span class="n">defaultLim</span>

	<span class="k">subroutine </span><span class="n">xylim</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span><span class="n">yb</span><span class="p">)</span>
		<span class="c">!! Set the x and y ranges of the plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">xb</span>
			<span class="c">!! x-range of plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">yb</span>
			<span class="c">!! y-range of plot</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="kd">::</span><span class="n">xbl</span><span class="p">,</span><span class="n">ybl</span>
		
		<span class="n">xbl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span>
		<span class="n">ybl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">yb</span><span class="p">)</span>
		
		<span class="k">call </span><span class="n">plwind</span><span class="p">(</span><span class="n">xbl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">xbl</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">ybl</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">ybl</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
	<span class="k">end subroutine </span><span class="n">xylim</span>

	<span class="k">subroutine </span><span class="n">xlim</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">xh</span><span class="p">)</span>
		<span class="c">!! Set the limits of the x-axis</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">xh</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span>
		
		<span class="k">call </span><span class="n">plgvpw</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plwind</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">pp</span><span class="p">),</span><span class="kt">real</span><span class="p">(</span><span class="n">xh</span><span class="p">,</span><span class="n">pp</span><span class="p">),</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
	<span class="k">end subroutine </span><span class="n">xlim</span>

	<span class="k">subroutine </span><span class="n">ylim</span><span class="p">(</span><span class="n">yl</span><span class="p">,</span><span class="n">yh</span><span class="p">)</span>
		<span class="c">!! Set the limits of the y-axis</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">yl</span><span class="p">,</span><span class="n">yh</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span>
		
		<span class="k">call </span><span class="n">plgvpw</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plwind</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">yl</span><span class="p">,</span><span class="n">pp</span><span class="p">),</span><span class="kt">real</span><span class="p">(</span><span class="n">yh</span><span class="p">,</span><span class="n">pp</span><span class="p">))</span>
	<span class="k">end subroutine </span><span class="n">ylim</span>

	<span class="k">subroutine </span><span class="n">xyzlim</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span><span class="n">yb</span><span class="p">,</span><span class="n">zb</span><span class="p">,</span><span class="n">altitude</span><span class="p">,</span><span class="n">azimuth</span><span class="p">,</span><span class="n">zoom</span><span class="p">)</span>
		<span class="c">!! Set the limits for a 3d plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">xb</span>
			<span class="c">!! x-range of plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">yb</span>
			<span class="c">!! y-range of plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">zb</span>
			<span class="c">!! z-range of plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">altitude</span>
			<span class="c">!! Altitude angle of plot in degrees</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">azimuth</span>
			<span class="c">!! Azimuth angle of plot in degrees</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">zoom</span>
			<span class="c">!! Zoom ratio (default 1.0)</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">al</span><span class="p">,</span><span class="n">az</span><span class="p">,</span><span class="n">zm</span>
		
		<span class="n">al</span> <span class="o">=</span> <span class="mi">4</span><span class="mf">5.0_pp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">altitude</span><span class="p">))</span> <span class="n">al</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">altitude</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
		<span class="n">az</span> <span class="o">=</span> <span class="mi">6</span><span class="mf">0.0_pp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">azimuth</span><span class="p">))</span> <span class="n">az</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">azimuth</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
		<span class="n">zm</span> <span class="o">=</span> <span class="mf">1.0_pp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">zoom</span><span class="p">))</span> <span class="n">zm</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">zoom</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
		
		<span class="k">call </span><span class="n">plwind</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0_pp</span><span class="p">,</span><span class="mf">1.0_pp</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0_pp</span><span class="p">,</span><span class="mf">1.5_pp</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plw3d</span><span class="p">(</span><span class="n">zm</span><span class="p">,</span><span class="n">zm</span><span class="p">,</span><span class="mf">1.2_pp</span><span class="o">*</span><span class="n">zm</span><span class="p">,</span> <span class="p">&amp;</span>
		<span class="p">&amp;</span> <span class="kt">real</span><span class="p">(</span><span class="n">xb</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">pp</span><span class="p">),</span><span class="kt">real</span><span class="p">(</span><span class="n">xb</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">pp</span><span class="p">),</span> <span class="p">&amp;</span>
		<span class="p">&amp;</span> <span class="kt">real</span><span class="p">(</span><span class="n">yb</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">pp</span><span class="p">),</span><span class="kt">real</span><span class="p">(</span><span class="n">yb</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">pp</span><span class="p">),</span> <span class="p">&amp;</span>
		<span class="p">&amp;</span> <span class="kt">real</span><span class="p">(</span><span class="n">zb</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">pp</span><span class="p">),</span><span class="kt">real</span><span class="p">(</span><span class="n">zb</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">pp</span><span class="p">),</span><span class="n">al</span><span class="p">,</span><span class="n">az</span><span class="p">)</span>
	<span class="k">end subroutine </span><span class="n">xyzlim</span>

	<span class="k">subroutine </span><span class="n">ticks</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">logx</span><span class="p">,</span><span class="n">logy</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="c">!! Set the ticks for the axes</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">dx</span>
			<span class="c">!! Spacing between ticks on x-axis</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">dy</span>
			<span class="c">!! Spacing between ticks on y-axis</span>
		<span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">logx</span>
			<span class="c">!! Flag for log-ticks and labels on x-axis</span>
		<span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">logy</span>
			<span class="c">!! Flag for log-ticks and labels on y-axis</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">color</span>
			<span class="c">!! Color code for ticks, box, and labels</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">linewidth</span>
			<span class="c">!! Line width for ticks and box</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">dxl</span><span class="p">,</span><span class="n">dyl</span>
		<span class="kt">character</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="kd">::</span><span class="n">xopts</span><span class="p">,</span><span class="n">yopts</span>
		
		<span class="n">dxl</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">dx</span><span class="p">))</span> <span class="n">dxl</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
		
		<span class="n">dyl</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">dy</span><span class="p">))</span> <span class="n">dyl</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
		
		<span class="n">xopts</span> <span class="o">=</span> <span class="s1">&#39;bcnst&#39;</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">logx</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			if</span><span class="p">(</span><span class="n">logx</span><span class="p">)</span> <span class="n">xopts</span> <span class="o">=</span> <span class="s1">&#39;bcnstl&#39;</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		</span><span class="n">yopts</span> <span class="o">=</span> <span class="s1">&#39;bcnstv&#39;</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">logy</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			if</span><span class="p">(</span><span class="n">logy</span><span class="p">)</span> <span class="n">yopts</span> <span class="o">=</span> <span class="s1">&#39;bcnstvl&#39;</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		call </span><span class="n">resetPen</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">color</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		
		<span class="k">call </span><span class="n">plbox</span><span class="p">(</span><span class="n">xopts</span><span class="p">,</span><span class="n">dxl</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">yopts</span><span class="p">,</span><span class="n">dyl</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">ticks</span>

	<span class="k">subroutine </span><span class="n">box</span><span class="p">(</span><span class="n">xLabel</span><span class="p">,</span><span class="n">yLabel</span><span class="p">,</span><span class="n">zLabel</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
		<span class="c">!! Set x,y and plot labels</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">xLabel</span>
			<span class="c">!! Label for x-axis</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">yLabel</span>
			<span class="c">!! Label for x-axis</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">zLabel</span>
			<span class="c">!! Label for z-axis</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">color</span>
			<span class="c">!! Color of labels</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">color</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plbox3</span><span class="p">(</span><span class="s1">&#39;bnstu&#39;</span><span class="p">,</span><span class="n">xLabel</span><span class="p">,</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;bnstu&#39;</span><span class="p">,</span><span class="n">yLabel</span><span class="p">,</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;bnstu&#39;</span><span class="p">,</span><span class="n">zLabel</span><span class="p">,</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">box</span>

	<span class="k">subroutine </span><span class="n">xticks</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">logScale</span><span class="p">,</span><span class="n">primary</span><span class="p">,</span><span class="n">secondary</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="c">!! Set the ticks for the x-axis</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">d</span>
			<span class="c">!! Spacing between ticks</span>
		<span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">logScale</span>
			<span class="c">!! Flag for log-ticks and labels</span>
		<span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">primary</span>
			<span class="c">!! Draw primary axis</span>
		<span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">secondary</span>
			<span class="c">!! Draw secondary axis</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">color</span>
			<span class="c">!! Color code for ticks, box, and labels</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">linewidth</span>
			<span class="c">!! Line width for ticks and box</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">dxl</span><span class="p">,</span><span class="n">dyl</span>
		<span class="kt">character</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="kd">::</span><span class="n">xopts</span><span class="p">,</span><span class="n">yopts</span>
		
		<span class="n">dxl</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
		<span class="n">dyl</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="n">dxl</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
		
		<span class="n">xopts</span> <span class="o">=</span> <span class="s1">&#39;nst&#39;</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">primary</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			if</span><span class="p">(</span><span class="n">primary</span><span class="p">)</span> <span class="n">xopts</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">xopts</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;b&#39;</span>
		<span class="k">else</span>
<span class="k">			</span><span class="n">xopts</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">xopts</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;b&#39;</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">secondary</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			if</span><span class="p">(</span><span class="n">secondary</span><span class="p">)</span> <span class="n">xopts</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">xopts</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;c&#39;</span>
		<span class="k">else</span>
<span class="k">			</span><span class="n">xopts</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">xopts</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;c&#39;</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">logScale</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			if</span><span class="p">(</span><span class="n">logScale</span><span class="p">)</span> <span class="n">xopts</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">xopts</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;l&#39;</span>
		<span class="k">end if</span>
<span class="k">		</span><span class="n">yopts</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">color</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plbox</span><span class="p">(</span><span class="n">xopts</span><span class="p">,</span><span class="n">dxl</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">yopts</span><span class="p">,</span><span class="n">dyl</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">xticks</span>

	<span class="k">subroutine </span><span class="n">yticks</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">logScale</span><span class="p">,</span><span class="n">primary</span><span class="p">,</span><span class="n">secondary</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="c">!! Set the ticks for the y-axis</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">d</span>
			<span class="c">!! Spacing between ticks</span>
		<span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">logScale</span>
			<span class="c">!! Flag for log-ticks and labels</span>
		<span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">primary</span>
			<span class="c">!! Draw primary axis</span>
		<span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">secondary</span>
			<span class="c">!! Draw secondary axis</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">color</span>
			<span class="c">!! Color code for ticks, box, and labels</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">linewidth</span>
			<span class="c">!! Line width for ticks and box</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">dxl</span><span class="p">,</span><span class="n">dyl</span>
		<span class="kt">character</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="kd">::</span><span class="n">xopts</span><span class="p">,</span><span class="n">yopts</span>
		
		<span class="n">dxl</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
		<span class="n">dyl</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="n">dyl</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
		
		<span class="n">yopts</span> <span class="o">=</span> <span class="s1">&#39;nst&#39;</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">primary</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			if</span><span class="p">(</span><span class="n">primary</span><span class="p">)</span> <span class="n">yopts</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">xopts</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;b&#39;</span>
		<span class="k">else</span>
<span class="k">			</span><span class="n">yopts</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">yopts</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;b&#39;</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">secondary</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			if</span><span class="p">(</span><span class="n">secondary</span><span class="p">)</span> <span class="n">yopts</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">yopts</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;c&#39;</span>
		<span class="k">else</span>
<span class="k">			</span><span class="n">yopts</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">yopts</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;c&#39;</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">logScale</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			if</span><span class="p">(</span><span class="n">logScale</span><span class="p">)</span> <span class="n">yopts</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">yopts</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;l&#39;</span>
		<span class="k">end if</span>
<span class="k">		</span><span class="n">xopts</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">color</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plbox</span><span class="p">(</span><span class="n">xopts</span><span class="p">,</span><span class="n">dxl</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">yopts</span><span class="p">,</span><span class="n">dyl</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">yticks</span>

	<span class="k">subroutine </span><span class="n">labels</span><span class="p">(</span><span class="n">xLabel</span><span class="p">,</span><span class="n">yLabel</span><span class="p">,</span><span class="n">plotLabel</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
		<span class="c">!! Set x,y and plot labels</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">xLabel</span>
			<span class="c">!! Label for x-axis</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">yLabel</span>
			<span class="c">!! Label for x-axis</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">plotLabel</span>
			<span class="c">!! Label entire plot</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">color</span>
			<span class="c">!! Color of labels</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">color</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		<span class="k">call </span><span class="n">pllab</span><span class="p">(</span><span class="n">xLabel</span><span class="p">,</span><span class="n">yLabel</span><span class="p">,</span><span class="n">plotLabel</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">labels</span>

	<span class="k">subroutine </span><span class="n">xlabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
		<span class="c">!! Set x-label</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">label</span>
			<span class="c">!! Label for axis</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">color</span>
			<span class="c">!! Color of labels</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">color</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plmtex</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="mf">3.0_pp</span><span class="p">,</span><span class="mf">0.5_pp</span><span class="p">,</span><span class="mf">0.5_pp</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">xlabel</span>

	<span class="k">subroutine </span><span class="n">ylabel</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
		<span class="c">!! Set y-label</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">label</span>
			<span class="c">!! Label for axis</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">color</span>
			<span class="c">!! Color of labels</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">color</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plmtex</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="mf">5.0_pp</span><span class="p">,</span><span class="mf">0.5_pp</span><span class="p">,</span><span class="mf">0.5_pp</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">ylabel</span>

	<span class="k">subroutine </span><span class="n">title</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
		<span class="c">!! Set plot title</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">label</span>
			<span class="c">!! Label for plot</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">color</span>
			<span class="c">!! Color of labels</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">color</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plmtex</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="mf">1.5_pp</span><span class="p">,</span><span class="mf">0.5_pp</span><span class="p">,</span><span class="mf">0.5_pp</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">title</span>

	<span class="k">subroutine </span><span class="n">colorbar</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">leftLabel</span><span class="p">,</span><span class="n">rightLabel</span><span class="p">)</span>
		<span class="c">!! Add a colorbar to the top of the plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">z</span>
			<span class="c">!! Data used for levels computation</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">N</span>
			<span class="c">!! Number of levels to compute</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">leftLabel</span>
			<span class="c">!! Label for left side of colorbar</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">rightLabel</span>
			<span class="c">!! Label for right side of colorbar</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">values</span>
		<span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="kd">::</span><span class="n">labels</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">fill_width</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">cont_width</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">cont_color</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">colorbar_width</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">colorbar_height</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">k</span>
		
		<span class="n">values</span> <span class="o">=</span> <span class="nb">reshape</span><span class="p">(</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="kt">real</span><span class="p">([(</span> <span class="kt">real</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">wp</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">wp</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nb">maxval</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">-</span><span class="nb">minval</span><span class="p">(</span><span class="n">z</span><span class="p">))</span><span class="o">+</span><span class="nb">minval</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)],</span><span class="n">pp</span><span class="p">),</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="p">[</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
		
		<span class="n">fill_width</span> <span class="o">=</span> <span class="mf">2.0_pp</span>
		<span class="n">cont_width</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
		<span class="n">cont_color</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">labels</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">leftLabel</span> <span class="p">))</span> <span class="n">labels</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">leftLabel</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">rightLabel</span><span class="p">))</span> <span class="n">labels</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">rightLabel</span>
		
		<span class="k">call </span><span class="n">plcolorbar</span><span class="p">(</span><span class="n">colorbar_width</span><span class="p">,</span><span class="n">colorbar_height</span><span class="p">,&amp;</span>
			<span class="p">&amp;</span> <span class="nb">ior</span><span class="p">(</span><span class="n">PL_COLORBAR_GRADIENT</span><span class="p">,</span><span class="n">PL_COLORBAR_SHADE_LABEL</span><span class="p">),</span><span class="n">PL_POSITION_TOP</span><span class="p">,&amp;</span>
			<span class="p">&amp;</span> <span class="mf">0.0_pp</span><span class="p">,</span><span class="mf">0.01_pp</span><span class="p">,</span><span class="mf">0.75_pp</span><span class="p">,</span><span class="mf">0.05_pp</span><span class="p">,&amp;</span>
			<span class="p">&amp;</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="mf">0.0_pp</span><span class="p">,</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="n">cont_color</span><span class="p">,</span><span class="n">cont_width</span><span class="p">,</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="p">[</span><span class="n">PL_COLORBAR_LABEL_LEFT</span><span class="p">,</span><span class="n">PL_COLORBAR_LABEL_RIGHT</span><span class="p">],</span><span class="n">labels</span><span class="p">,</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="p">[</span><span class="s1">&#39;bcvmt&#39;</span><span class="p">],[</span><span class="mf">0.0_pp</span><span class="p">],[</span><span class="mi">0</span><span class="p">],[</span><span class="n">size</span><span class="p">(</span><span class="n">values</span><span class="p">)],</span><span class="n">values</span><span class="p">)</span>
	<span class="k">end subroutine </span><span class="n">colorbar</span>

	<span class="k">subroutine </span><span class="n">legend</span><span class="p">(</span><span class="n">corner</span><span class="p">,</span><span class="n">series</span><span class="p">,</span><span class="n">lineWidths</span><span class="p">,</span><span class="n">markScales</span><span class="p">,</span><span class="n">markCounts</span><span class="p">,</span><span class="n">ncol</span><span class="p">)</span>
		<span class="c">!! Create legend for plot data</span>
		<span class="c">!!</span>
		<span class="c">!! FIXME: Text sizing should be modifiable</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">corner</span>
			<span class="c">!! Corner for legend</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">series</span>
			<span class="c">!! Data series in rows</span>
			<span class="c">!! [name,textColor,lineStyle,lineColor,markStyle,markColor,boxColor]</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineWidths</span>
			<span class="c">!! Line widths for the plots</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">markScales</span>
			<span class="c">!! Marker sizes for the plots</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">markCounts</span>
			<span class="c">!! Marker counts for the plots</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">ncol</span>
			<span class="c">!! Number of columns</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">xoff</span><span class="p">,</span><span class="n">yoff</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">plotWidth</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">opt</span><span class="p">,</span><span class="n">cornerl</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">bg_color</span><span class="p">,</span><span class="n">bb_color</span><span class="p">,</span><span class="n">bb_style</span><span class="p">,</span><span class="n">lncol</span><span class="p">,</span><span class="n">lnrow</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="kd">::</span><span class="n">opts</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="kd">::</span><span class="n">lwidths</span><span class="p">,</span><span class="n">mscales</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="kd">::</span><span class="n">mcounts</span><span class="p">,</span><span class="n">text_colors</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">text_offset</span><span class="p">,</span><span class="n">text_scale</span><span class="p">,</span><span class="n">text_spacing</span><span class="p">,</span><span class="n">text_justification</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="kd">::</span><span class="n">box_colors</span><span class="p">,</span><span class="n">box_patterns</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="kd">::</span><span class="n">box_scales</span><span class="p">,</span><span class="n">box_line_widths</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="kd">::</span><span class="n">line_colors</span><span class="p">,</span><span class="n">line_styles</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="kd">::</span><span class="n">mark_colors</span>
		<span class="kt">character</span><span class="p">(</span><span class="mi">64</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="kd">::</span><span class="n">mark_styles</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">k</span>
		
		<span class="k">call </span><span class="n">doLegendBox</span>
		
		<span class="n">opts</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="n">series</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">/=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="n">opts</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">ior</span><span class="p">(</span><span class="n">opts</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">PL_LEGEND_LINE</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="n">series</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="o">/=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="n">opts</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">ior</span><span class="p">(</span><span class="n">opts</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">PL_LEGEND_SYMBOL</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="n">series</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span><span class="o">/=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="n">opts</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="nb">ior</span><span class="p">(</span><span class="n">opts</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">PL_LEGEND_COLOR_BOX</span><span class="p">)</span>
		<span class="k">end do</span>
<span class="k">		</span>
<span class="k">		call </span><span class="n">doText</span>
		<span class="k">call </span><span class="n">doBoxes</span>
		<span class="k">call </span><span class="n">doLines</span>
		<span class="k">call </span><span class="n">doMarkers</span>
		
		<span class="k">call </span><span class="n">pllegend</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">opt</span><span class="p">,</span><span class="n">cornerl</span><span class="p">,</span><span class="n">xoff</span><span class="p">,</span><span class="n">yoff</span><span class="p">,</span><span class="n">plotWidth</span><span class="p">,</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="n">bg_color</span><span class="p">,</span><span class="n">bb_color</span><span class="p">,</span><span class="n">bb_style</span><span class="p">,</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="n">lnrow</span><span class="p">,</span><span class="n">lncol</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">opts</span><span class="p">,</span><span class="n">text_offset</span><span class="p">,</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="n">text_scale</span><span class="p">,</span><span class="n">text_spacing</span><span class="p">,</span><span class="n">text_justification</span><span class="p">,</span><span class="n">text_colors</span><span class="p">,</span><span class="n">series</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="n">box_colors</span><span class="p">,</span><span class="n">box_patterns</span><span class="p">,</span><span class="n">box_scales</span><span class="p">,</span><span class="n">box_line_widths</span><span class="p">,</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="n">line_colors</span><span class="p">,</span><span class="n">line_styles</span><span class="p">,</span><span class="n">lwidths</span><span class="p">,</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="n">mark_colors</span><span class="p">,</span><span class="n">mscales</span><span class="p">,</span><span class="n">mcounts</span><span class="p">,</span><span class="n">mark_styles</span><span class="p">)</span>
		
	<span class="k">contains</span>
<span class="k">	</span>
<span class="k">		subroutine </span><span class="n">doLegendBox</span>
			<span class="n">opt</span> <span class="o">=</span> <span class="n">PL_LEGEND_BACKGROUND</span><span class="o">+</span><span class="n">PL_LEGEND_BOUNDING_BOX</span>
			<span class="n">cornerl</span> <span class="o">=</span> <span class="n">getCorner</span><span class="p">(</span><span class="n">corner</span><span class="p">)</span>
			<span class="n">xoff</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
			<span class="n">yoff</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
			<span class="n">plotWidth</span> <span class="o">=</span> <span class="mf">0.05_pp</span>
			<span class="n">bg_color</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">bb_color</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="n">bb_style</span> <span class="o">=</span> <span class="n">getLineStyleCode</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
			
			<span class="n">lncol</span> <span class="o">=</span> <span class="mi">1</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">ncol</span><span class="p">))</span> <span class="n">lncol</span> <span class="o">=</span> <span class="n">ncol</span>
			<span class="n">lnrow</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">lncol</span>
		<span class="k">end subroutine </span><span class="n">doLegendBox</span>
	
		<span class="k">subroutine </span><span class="n">doText</span>
			<span class="n">text_offset</span>  <span class="o">=</span> <span class="mf">0.3_pp</span>
			<span class="n">text_scale</span>   <span class="o">=</span> <span class="n">fontScale</span>
			<span class="n">text_spacing</span> <span class="o">=</span> <span class="mf">3.0_pp</span>
			<span class="n">text_justification</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
			
			<span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">text_colors</span> <span class="o">=</span> <span class="n">getColorCode</span><span class="p">(</span><span class="n">series</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
			<span class="k">end do</span>
<span class="k">		end subroutine </span><span class="n">doText</span>
	
		<span class="k">subroutine </span><span class="n">doBoxes</span>
			<span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">box_colors</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">getColorCode</span><span class="p">(</span><span class="n">series</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
			<span class="k">end do</span>
<span class="k">			</span><span class="n">box_patterns</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">box_scales</span> <span class="o">=</span> <span class="mf">0.5_pp</span>
			<span class="n">box_line_widths</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
		<span class="k">end subroutine </span><span class="n">doBoxes</span>
	
		<span class="k">subroutine </span><span class="n">doLines</span>
			<span class="n">lwidths</span> <span class="o">=</span> <span class="mf">1.0_pp</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidths</span><span class="p">))</span> <span class="n">lwidths</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">lineWidths</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
			
			<span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">line_colors</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">getColorCode</span><span class="p">(</span><span class="n">series</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
				<span class="n">line_styles</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">getLineStyleCode</span><span class="p">(</span><span class="n">series</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
			<span class="k">end do</span>
<span class="k">		end subroutine </span><span class="n">doLines</span>
	
		<span class="k">subroutine </span><span class="n">doMarkers</span>
			<span class="n">mcounts</span> <span class="o">=</span> <span class="mi">2</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markCounts</span><span class="p">))</span> <span class="n">mcounts</span> <span class="o">=</span> <span class="n">markCounts</span>
			<span class="n">mscales</span> <span class="o">=</span> <span class="mf">1.0_pp</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markScales</span><span class="p">))</span> <span class="n">mscales</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">markScales</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
			
			<span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">series</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">mark_colors</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">getColorCode</span><span class="p">(</span><span class="n">series</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
				<span class="n">mark_styles</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">getSymbolCode</span><span class="p">(</span><span class="n">series</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
			<span class="k">end do</span>
<span class="k">		end subroutine </span><span class="n">doMarkers</span>
	
		<span class="k">function </span><span class="n">getCorner</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
			<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">text</span>
			<span class="kt">integer</span><span class="kd">::</span><span class="n">code</span>
			
			<span class="n">code</span> <span class="o">=</span> <span class="n">PL_POSITION_INSIDE</span>
			<span class="k">if</span><span class="p">(</span> <span class="n">startsWith</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">+</span><span class="n">PL_POSITION_TOP</span>
			<span class="k">if</span><span class="p">(</span> <span class="n">startsWith</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">+</span><span class="n">PL_POSITION_BOTTOM</span>
			<span class="k">if</span><span class="p">(</span>   <span class="n">endsWith</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">)</span> <span class="p">)</span> <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">+</span><span class="n">PL_POSITION_RIGHT</span>
			<span class="k">if</span><span class="p">(</span>   <span class="n">endsWith</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="s1">&#39;left&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">+</span><span class="n">PL_POSITION_LEFT</span>
		<span class="k">end function </span><span class="n">getCorner</span>
	
	<span class="k">end subroutine </span><span class="n">legend</span>

	<span class="c">!=====================!</span>
	<span class="c">!= Plotting Routines =!</span>
	<span class="c">!=====================!</span>

	<span class="k">subroutine </span><span class="n">hist</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">db</span><span class="p">,</span><span class="n">relWidth</span><span class="p">,</span><span class="n">fillColor</span><span class="p">,</span><span class="n">fillPattern</span><span class="p">,</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="c">!! Create a histogram</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">d</span>
			<span class="c">!! Data for binning</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">N</span>
			<span class="c">!! Number of bins</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">db</span>
			<span class="c">!! Boundaries of bin range</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">relWidth</span>
			<span class="c">!! Relative width of bars (default 0.8)</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">fillColor</span>
			<span class="c">!! Color of bar fills</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">fillPattern</span>
			<span class="c">!! Pattern of bar fills</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineColor</span>
			<span class="c">!! Color of lines around bars</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineWidth</span>
			<span class="c">!! Width of lines around bars</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">h</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="kd">::</span><span class="n">dbl</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">Nl</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="kd">::</span><span class="n">relWidthl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="kd">::</span><span class="n">lineWidthl</span>
		
		<span class="n">Nl</span> <span class="o">=</span> <span class="mi">20</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="n">Nl</span> <span class="o">=</span> <span class="n">N</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">db</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			</span><span class="n">dbl</span> <span class="o">=</span> <span class="n">db</span>
		<span class="k">else</span>
<span class="k">			</span><span class="n">dbl</span> <span class="o">=</span> <span class="n">mixval</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">+</span><span class="p">[</span><span class="o">-</span><span class="mf">1.0_wp</span><span class="p">,</span><span class="mf">1.0_wp</span><span class="p">]</span><span class="o">*</span><span class="nb">epsilon</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">)</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		</span><span class="n">h</span> <span class="o">=</span> <span class="n">binData</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">Nl</span><span class="p">,</span><span class="n">dbl</span><span class="p">,</span><span class="n">normalize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
		
		<span class="n">relWidthl</span> <span class="o">=</span> <span class="mf">1.0_wp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">relWidth</span><span class="p">))</span> <span class="n">relWidthl</span> <span class="o">=</span> <span class="n">relWidth</span>
		<span class="n">lineWidthl</span> <span class="o">=</span> <span class="mf">0.5_wp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="n">lineWidthl</span> <span class="o">=</span> <span class="n">lineWidth</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineColor</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillColor</span><span class="p">))</span> <span class="k">then</span>
<span class="k">				if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">))</span> <span class="k">then</span>
<span class="k">					call </span><span class="n">bar</span><span class="p">(</span><span class="n">h</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">relWidth</span><span class="o">=</span><span class="n">relWidthl</span><span class="p">,</span><span class="n">lineColor</span><span class="o">=</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineWidth</span><span class="o">=</span><span class="n">lineWidthl</span><span class="p">,</span> <span class="p">&amp;</span>
					<span class="p">&amp;</span> <span class="n">fillColor</span><span class="o">=</span><span class="n">fillColor</span><span class="p">,</span><span class="n">fillPattern</span><span class="o">=</span><span class="n">fillPattern</span><span class="p">)</span>
				<span class="k">else</span>
<span class="k">					call </span><span class="n">bar</span><span class="p">(</span><span class="n">h</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">relWidth</span><span class="o">=</span><span class="n">relWidthl</span><span class="p">,</span><span class="n">lineColor</span><span class="o">=</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineWidth</span><span class="o">=</span><span class="n">lineWidthl</span><span class="p">,</span> <span class="p">&amp;</span>
					<span class="p">&amp;</span> <span class="n">fillColor</span><span class="o">=</span><span class="n">fillColor</span><span class="p">)</span>
				<span class="k">end if</span>
<span class="k">			else</span>
<span class="k">				if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">))</span> <span class="k">then</span>
<span class="k">					call </span><span class="n">bar</span><span class="p">(</span><span class="n">h</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">relWidth</span><span class="o">=</span><span class="n">relWidthl</span><span class="p">,</span><span class="n">lineColor</span><span class="o">=</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineWidth</span><span class="o">=</span><span class="n">lineWidthl</span><span class="p">,</span> <span class="p">&amp;</span>
					<span class="p">&amp;</span> <span class="n">fillPattern</span><span class="o">=</span><span class="n">fillPattern</span><span class="p">)</span>
				<span class="k">else</span>
<span class="k">					call </span><span class="n">bar</span><span class="p">(</span><span class="n">h</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">relWidth</span><span class="o">=</span><span class="n">relWidthl</span><span class="p">,</span><span class="n">lineColor</span><span class="o">=</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineWidth</span><span class="o">=</span><span class="n">lineWidthl</span><span class="p">)</span>
				<span class="k">end if</span>
<span class="k">			end if</span>
<span class="k">		else</span>
<span class="k">			if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillColor</span><span class="p">))</span> <span class="k">then</span>
<span class="k">				if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">))</span> <span class="k">then</span>
<span class="k">					call </span><span class="n">bar</span><span class="p">(</span><span class="n">h</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">relWidth</span><span class="o">=</span><span class="n">relWidthl</span><span class="p">,</span><span class="n">lineWidth</span><span class="o">=</span><span class="n">lineWidthl</span><span class="p">,</span> <span class="p">&amp;</span>
					<span class="p">&amp;</span> <span class="n">fillColor</span><span class="o">=</span><span class="n">fillColor</span><span class="p">,</span><span class="n">fillPattern</span><span class="o">=</span><span class="n">fillPattern</span><span class="p">)</span>
				<span class="k">else</span>
<span class="k">					call </span><span class="n">bar</span><span class="p">(</span><span class="n">h</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">relWidth</span><span class="o">=</span><span class="n">relWidthl</span><span class="p">,</span><span class="n">lineWidth</span><span class="o">=</span><span class="n">lineWidthl</span><span class="p">,</span> <span class="p">&amp;</span>
					<span class="p">&amp;</span> <span class="n">fillColor</span><span class="o">=</span><span class="n">fillColor</span><span class="p">)</span>
				<span class="k">end if</span>
<span class="k">			else</span>
<span class="k">				if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">))</span> <span class="k">then</span>
<span class="k">					call </span><span class="n">bar</span><span class="p">(</span><span class="n">h</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">relWidth</span><span class="o">=</span><span class="n">relWidthl</span><span class="p">,</span><span class="n">lineWidth</span><span class="o">=</span><span class="n">lineWidthl</span><span class="p">,</span> <span class="p">&amp;</span>
					<span class="p">&amp;</span> <span class="n">fillPattern</span><span class="o">=</span><span class="n">fillPattern</span><span class="p">)</span>
				<span class="k">else</span>
<span class="k">					call </span><span class="n">bar</span><span class="p">(</span><span class="n">h</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">h</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="n">relWidth</span><span class="o">=</span><span class="n">relWidthl</span><span class="p">,</span><span class="n">lineWidth</span><span class="o">=</span><span class="n">lineWidthl</span><span class="p">)</span>
				<span class="k">end if</span>
<span class="k">			end if</span>
<span class="k">		end if</span>

<span class="k">		</span>
<span class="k">		call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">hist</span>

	<span class="k">subroutine </span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">markColor</span><span class="p">,</span><span class="n">markStyle</span><span class="p">,</span><span class="n">markSize</span><span class="p">)</span>
		<span class="c">!! Create scatter plot of data</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! x-coordinates of data</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
			<span class="c">!! y-coordinates of data</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">c</span>
			<span class="c">!! Data for smooth coloring</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">s</span>
			<span class="c">!! Data for marker scaling</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">markColor</span>
			<span class="c">!! Color of markers; overridden by z</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">markStyle</span>
			<span class="c">!! Style of markers</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">markSize</span>
			<span class="c">!! Size of markers</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">cb</span>
		<span class="kt">character</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="kd">::</span><span class="n">code</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">k</span>
		
		<span class="n">xl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">yl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">markColor</span><span class="p">)</span>
		<span class="n">code</span> <span class="o">=</span> <span class="n">getSymbolCode</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markStyle</span><span class="p">))</span> <span class="n">code</span> <span class="o">=</span> <span class="n">getSymbolCode</span><span class="p">(</span><span class="n">markStyle</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markSize</span><span class="p">))</span> <span class="k">call </span><span class="n">plschr</span><span class="p">(</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">markSize</span><span class="p">,</span><span class="n">pp</span><span class="p">))</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markSize</span><span class="p">))</span> <span class="k">call </span><span class="n">plssym</span><span class="p">(</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">markSize</span><span class="p">,</span><span class="n">pp</span><span class="p">))</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="n">cb</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">mixval</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">pp</span><span class="p">)</span>
		<span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">call </span><span class="n">plcol1</span><span class="p">(</span> <span class="kt">real</span><span class="p">(</span> <span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">cb</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">cb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">cb</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">,</span><span class="n">pp</span><span class="p">)</span> <span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="k">call </span><span class="n">plschr</span><span class="p">(</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">pp</span><span class="p">))</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="k">call </span><span class="n">plssym</span><span class="p">(</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">pp</span><span class="p">))</span>
			<span class="k">call </span><span class="n">plptex</span><span class="p">(</span><span class="n">xl</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">yl</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="mf">0.5_pp</span><span class="p">,</span><span class="n">code</span><span class="p">)</span>
		<span class="k">end do</span>
<span class="k">		call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">scatter</span>

	<span class="k">subroutine </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineStyle</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">,</span><span class="n">markColor</span><span class="p">,</span><span class="n">markStyle</span><span class="p">,</span><span class="n">markSize</span><span class="p">)</span>
		<span class="c">!! Plot data using lines and or markers</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! x-data for plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
			<span class="c">!! y-data for plot</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineColor</span>
			<span class="c">!! Color of line</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineStyle</span>
			<span class="c">!! Style of line; &#39;&#39; for no line</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineWidth</span>
			<span class="c">!! Width of line</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">markColor</span>
			<span class="c">!! Color of markers, if any</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">markStyle</span>
			<span class="c">!! Style of markers; &#39;&#39; or absent for none</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">markSize</span>
			<span class="c">!! Size of markers, if any</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span>
		<span class="kt">character</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="kd">::</span><span class="n">code</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">k</span>
		
		<span class="n">xl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">yl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">lineColor</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			call </span><span class="n">setLineStyle</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="n">lineStyle</span><span class="o">/=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">call </span><span class="n">plline</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">)</span>
		<span class="k">else</span>
<span class="k">			call </span><span class="n">plline</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">)</span>
		<span class="k">end if</span>
<span class="k">		call </span><span class="n">resetPen</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">markColor</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markSize</span><span class="p">))</span> <span class="k">call </span><span class="n">plssym</span><span class="p">(</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">markSize</span><span class="p">,</span><span class="n">pp</span><span class="p">))</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markStyle</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			</span><span class="n">code</span> <span class="o">=</span> <span class="n">getSymbolCode</span><span class="p">(</span><span class="n">markStyle</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="n">markStyle</span><span class="o">/=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">				do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
					<span class="k">call </span><span class="n">plptex</span><span class="p">(</span><span class="n">xl</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">yl</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="mf">0.5_pp</span><span class="p">,</span><span class="n">code</span><span class="p">)</span>
				<span class="k">end do</span>
<span class="k">			end if</span>
<span class="k">		end if</span>
<span class="k">		call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">plot</span>

	<span class="k">subroutine </span><span class="n">plot3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineStyle</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">,</span><span class="n">markColor</span><span class="p">,</span><span class="n">markStyle</span><span class="p">,</span><span class="n">markSize</span><span class="p">)</span>
		<span class="c">!! Plot data using lines and or markers</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! x-data for plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
			<span class="c">!! y-data for plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">z</span>
			<span class="c">!! z-data for plot</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineColor</span>
			<span class="c">!! Color of line</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineStyle</span>
			<span class="c">!! Style of line; &#39;&#39; for no line</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineWidth</span>
			<span class="c">!! Width of line</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">markColor</span>
			<span class="c">!! Color of markers, if any</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">markStyle</span>
			<span class="c">!! Style of markers; &#39;&#39; or absent for none</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">markSize</span>
			<span class="c">!! Size of markers, if any</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">,</span><span class="n">zl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span><span class="p">,</span><span class="n">sx</span><span class="p">,</span><span class="n">sy</span><span class="p">,</span><span class="n">sz</span>
		<span class="kt">character</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="kd">::</span><span class="n">code</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">k</span>
		
		<span class="n">xl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">yl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
		<span class="n">zl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">lineColor</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			call </span><span class="n">setLineStyle</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="n">lineStyle</span><span class="o">/=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">call </span><span class="n">plline</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">)</span>
		<span class="k">else</span>
<span class="k">			call </span><span class="n">plline3</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">,</span><span class="n">zl</span><span class="p">)</span>
		<span class="k">end if</span>
<span class="k">		call </span><span class="n">resetPen</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">markColor</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markSize</span><span class="p">))</span> <span class="k">call </span><span class="n">plssym</span><span class="p">(</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">markSize</span><span class="p">,</span><span class="n">pp</span><span class="p">))</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">markStyle</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			</span><span class="n">code</span> <span class="o">=</span> <span class="n">getSymbolCode</span><span class="p">(</span><span class="n">markStyle</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="n">markStyle</span><span class="o">/=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">then</span>
<span class="k">				</span><span class="n">dx</span> <span class="o">=</span> <span class="mf">1.0_pp</span>
				<span class="n">dy</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
				<span class="n">dz</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
				<span class="n">sx</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
				<span class="n">sy</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
				<span class="n">sz</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
				<span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
					<span class="k">call </span><span class="n">plptex3</span><span class="p">(</span><span class="n">xl</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">yl</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">zl</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">dz</span><span class="p">,</span><span class="n">sx</span><span class="p">,</span><span class="n">sy</span><span class="p">,</span><span class="n">sz</span><span class="p">,</span><span class="mf">0.5_pp</span><span class="p">,</span><span class="n">code</span><span class="p">)</span>
				<span class="k">end do</span>
<span class="k">			end if</span>
<span class="k">		end if</span>
<span class="k">		call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">plot3</span>

	<span class="k">subroutine </span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineStyle</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="c">!! Plot contour lines</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! x-coordinates of data</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
			<span class="c">!! y-coordinates of data</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">z</span>
			<span class="c">!! Data for contouring</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">N</span>
			<span class="c">!! Number of levels to use in contour</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineColor</span>
			<span class="c">!! Color of contour lines</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineStyle</span>
			<span class="c">!! Style of contour lines</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineWidth</span>
			<span class="c">!! Width of contour lines</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">zl</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">edge</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">Nl</span><span class="p">,</span><span class="n">k</span>
		
		<span class="n">xl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">yl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
		<span class="n">zl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
		<span class="n">Nl</span> <span class="o">=</span> <span class="mi">20</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="n">Nl</span> <span class="o">=</span> <span class="n">N</span>
		<span class="n">edge</span> <span class="o">=</span> <span class="p">[(</span> <span class="kt">real</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="n">Nl</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="nb">maxval</span><span class="p">(</span><span class="n">zl</span><span class="p">)</span><span class="o">-</span><span class="nb">minval</span><span class="p">(</span><span class="n">zl</span><span class="p">))</span><span class="o">+</span><span class="nb">minval</span><span class="p">(</span><span class="n">zl</span><span class="p">)</span> <span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Nl</span><span class="p">)]</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">lineColor</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineStyle</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		
		<span class="k">call </span><span class="n">plcont</span><span class="p">(</span><span class="n">zl</span><span class="p">,</span><span class="n">edge</span><span class="p">,</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">contour</span>

	<span class="k">subroutine </span><span class="n">surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">lineStyle</span><span class="p">)</span>
		<span class="c">!! Plot a 3d surface</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! x-coordinates of data</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
			<span class="c">!! y-coordinates of data</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">z</span>
			<span class="c">!! Data for contouring</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">N</span>
			<span class="c">!! Number of levels to use in surface colors</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineStyle</span>
			<span class="c">!! Style for xy lines ( &#39;-&#39; = on, &#39;&#39; = off )</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">zl</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">edge</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">Nl</span><span class="p">,</span><span class="n">opt</span>
		
		<span class="n">opt</span> <span class="o">=</span> <span class="n">MAG_COLOR</span>
		
		<span class="n">xl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">yl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
		<span class="n">zl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
		<span class="n">Nl</span> <span class="o">=</span> <span class="mi">20</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			</span><span class="n">Nl</span> <span class="o">=</span> <span class="n">N</span>
			<span class="n">opt</span> <span class="o">=</span> <span class="nb">ior</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span><span class="n">SURF_CONT</span><span class="p">)</span>
		<span class="k">end if</span>
<span class="k">		</span><span class="n">edge</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="nb">minval</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="n">Nl</span><span class="p">))</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			select case</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">)</span>
			<span class="k">case</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
				<span class="n">opt</span> <span class="o">=</span> <span class="n">opt</span>
			<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
				<span class="n">opt</span> <span class="o">=</span> <span class="nb">ior</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span><span class="n">FACETED</span><span class="p">)</span>
			<span class="k">end select</span>
<span class="k">		end if</span>
<span class="k">		</span>
<span class="k">		call </span><span class="n">plsurf3d</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">,</span><span class="n">zl</span><span class="p">,</span><span class="n">opt</span><span class="p">,</span><span class="n">edge</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">surface</span>

	<span class="k">subroutine </span><span class="n">wireframe</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">lineColor</span><span class="p">)</span>
		<span class="c">!! Plot a 3d wireframe</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! x-coordinates of data</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
			<span class="c">!! y-coordinates of data</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">z</span>
			<span class="c">!! Data for contouring</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineColor</span>
			<span class="c">!! Color of contour lines</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">zl</span>
		
		<span class="n">xl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">yl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
		<span class="n">zl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineColor</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			call </span><span class="n">setColor</span><span class="p">(</span><span class="n">lineColor</span><span class="p">)</span>
			<span class="k">call </span><span class="n">plot3d</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">,</span><span class="n">zl</span><span class="p">,</span><span class="n">DRAW_LINEXY</span><span class="p">,.</span><span class="n">false</span><span class="p">.)</span>
		<span class="k">else</span>
<span class="k">			call </span><span class="n">plot3d</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">,</span><span class="n">zl</span><span class="p">,</span><span class="nb">ior</span><span class="p">(</span><span class="n">DRAW_LINEXY</span><span class="p">,</span><span class="n">MAG_COLOR</span><span class="p">),.</span><span class="n">false</span><span class="p">.)</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">wireframe</span>

	<span class="k">subroutine </span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
		<span class="c">!! Plot filled contours</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! x-coordinates of data</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
			<span class="c">!! y-coordinates of data</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">z</span>
			<span class="c">!! Data for contouring</span>
		<span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">N</span>
			<span class="c">!! Number of levels to use in contour</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">zl</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">edge</span>
		
		<span class="kt">character</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="kd">::</span><span class="n">defined</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">fill_width</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">cont_width</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">cont_color</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">Nl</span>
		
		<span class="n">xl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">yl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
		<span class="n">zl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
		<span class="n">Nl</span> <span class="o">=</span> <span class="mi">20</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="n">Nl</span> <span class="o">=</span> <span class="n">N</span>
		
		<span class="n">edge</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="nb">minval</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="n">Nl</span><span class="p">))</span>
		
		<span class="n">fill_width</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0_pp</span>
		<span class="n">cont_width</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0_pp</span>
		<span class="n">cont_color</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
		
		<span class="k">call </span><span class="n">plshades</span><span class="p">(</span><span class="n">zl</span><span class="p">,</span><span class="n">defined</span><span class="p">,</span><span class="nb">minval</span><span class="p">(</span><span class="n">xl</span><span class="p">),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">xl</span><span class="p">),</span><span class="nb">minval</span><span class="p">(</span><span class="n">yl</span><span class="p">),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">yl</span><span class="p">),</span> <span class="p">&amp;</span>
			<span class="p">&amp;</span> <span class="n">edge</span><span class="p">,</span><span class="n">fill_width</span><span class="p">,</span><span class="n">cont_color</span><span class="p">,</span><span class="n">cont_width</span><span class="p">)</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">contourf</span>

	<span class="k">subroutine </span><span class="n">quiver</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">scaling</span><span class="p">,</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineStyle</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="c">!! Plot vectors</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! x-positions of vectors</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
			<span class="c">!! y-positions of vectors</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">u</span>
			<span class="c">!! u-components of vectors</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">v</span>
			<span class="c">!! v-components of vectors</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">s</span>
			<span class="c">!! Scale of vectors</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">c</span>
			<span class="c">!! Color values for vectors</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">scaling</span>
			<span class="c">!! Scaling of vectors</span>
			<span class="c">!! &lt; 0 = Automatic, then scaled</span>
			<span class="c">!!   0 = Automatic</span>
			<span class="c">!! &gt; 0 = Directly scaled</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineColor</span>
			<span class="c">!! Color of vectors</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineStyle</span>
			<span class="c">!! Style of vectors&#39; lines</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineWidth</span>
			<span class="c">!! Width of vectors&#39; lines</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:,:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">ul</span><span class="p">,</span><span class="n">vl</span><span class="p">,</span><span class="n">sl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="kd">::</span><span class="n">xb</span><span class="p">,</span><span class="n">yb</span><span class="p">,</span><span class="n">sb</span><span class="p">,</span><span class="n">cb</span><span class="p">,</span><span class="n">d</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">scalingl</span><span class="p">,</span><span class="n">scl</span><span class="p">,</span><span class="n">mag</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">i</span><span class="p">,</span><span class="n">j</span>
		
		<span class="n">xl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">yl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
		<span class="n">ul</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
		<span class="n">vl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
		
		<span class="n">d</span> <span class="o">=</span> <span class="kt">real</span><span class="p">([</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span><span class="n">pp</span><span class="p">)</span>
		
		<span class="n">xb</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">mixval</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">pp</span><span class="p">)</span>
		<span class="n">yb</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">mixval</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">pp</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			</span><span class="n">sl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
			<span class="n">sl</span> <span class="o">=</span> <span class="n">sl</span><span class="o">/</span><span class="nb">maxval</span><span class="p">(</span><span class="n">sl</span><span class="p">)</span>
		<span class="k">else</span>
<span class="k">			</span><span class="n">sl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
			<span class="n">sl</span> <span class="o">=</span> <span class="nb">sqrt</span><span class="p">(</span><span class="n">sl</span><span class="p">)</span>
			<span class="n">sl</span> <span class="o">=</span> <span class="n">sl</span><span class="o">/</span><span class="nb">maxval</span><span class="p">(</span><span class="n">sl</span><span class="p">)</span>
		<span class="k">end if</span>
<span class="k">		</span><span class="n">sb</span> <span class="o">=</span> <span class="p">[</span><span class="nb">minval</span><span class="p">(</span><span class="n">sl</span><span class="p">),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">sl</span><span class="p">)]</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="n">cb</span> <span class="o">=</span> <span class="kt">real</span><span class="p">([</span><span class="nb">minval</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="nb">maxval</span><span class="p">(</span><span class="n">c</span><span class="p">)],</span><span class="n">pp</span><span class="p">)</span>
		
		<span class="n">scalingl</span> <span class="o">=</span> <span class="mf">1.0_pp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">scaling</span><span class="p">))</span> <span class="n">scalingl</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">scaling</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">lineColor</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineStyle</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		
		<span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
			<span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
				<span class="n">mag</span> <span class="o">=</span> <span class="nb">norm2</span><span class="p">([</span><span class="n">ul</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">vl</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)])</span>
				<span class="n">scl</span> <span class="o">=</span> <span class="n">scalingl</span><span class="o">*</span><span class="nb">norm2</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="n">sl</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
				<span class="k">if</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">scl</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.0E-5_wp</span><span class="p">)</span> <span class="k">cycle</span>
<span class="k">				if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">call </span><span class="n">plcol1</span><span class="p">(</span> <span class="kt">real</span><span class="p">(</span> <span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">-</span><span class="n">cb</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">cb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">cb</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">,</span><span class="n">pp</span><span class="p">)</span> <span class="p">)</span>
				<span class="k">call </span><span class="n">plvect</span><span class="p">(</span><span class="n">ul</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">mag</span><span class="p">,</span><span class="n">vl</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">mag</span><span class="p">,</span><span class="n">scl</span><span class="p">,</span><span class="n">xl</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">),</span><span class="n">yl</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">))</span>
			<span class="k">end do</span>
<span class="k">		end do</span>
<span class="k">		</span>
<span class="k">		call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">quiver</span>

	<span class="k">subroutine </span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">relWidth</span><span class="p">,</span><span class="n">fillColor</span><span class="p">,</span><span class="n">fillPattern</span><span class="p">,</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="c">!! Create a bar graph</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! x-positions of the bars&#39; centers</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
			<span class="c">!! y-positions of the bars&#39; tops</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">c</span>
			<span class="c">!! Color scale for bars</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">relWidth</span>
			<span class="c">!! Relative width of bars (default 0.8)</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">fillColor</span>
			<span class="c">!! Color of bar fills</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">fillPattern</span>
			<span class="c">!! Pattern of bar fills</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineColor</span>
			<span class="c">!! Color of lines around bars</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineWidth</span>
			<span class="c">!! Width of lines around bars</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="kd">::</span><span class="n">cb</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">dx</span><span class="p">,</span><span class="n">dxs</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">k</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="n">cb</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">mixval</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">pp</span><span class="p">)</span>
		<span class="n">dxs</span> <span class="o">=</span> <span class="mf">0.8_pp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">relWidth</span><span class="p">))</span> <span class="n">dxs</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">relWidth</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">			</span><span class="n">dx</span> <span class="o">=</span> <span class="n">dxs</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="n">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">pp</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0_pp</span>
		<span class="k">else</span>
<span class="k">			</span><span class="n">dx</span> <span class="o">=</span> <span class="n">dxs</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		
		<span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
			<span class="n">xl</span> <span class="o">=</span> <span class="kt">real</span><span class="p">([</span><span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span><span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span><span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">dx</span><span class="p">],</span><span class="n">pp</span><span class="p">)</span>
			<span class="n">yl</span> <span class="o">=</span> <span class="kt">real</span><span class="p">([</span><span class="mf">0.0_wp</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">y</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mf">0.0_wp</span><span class="p">],</span><span class="n">pp</span><span class="p">)</span>
			
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">fillColor</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">))</span> <span class="k">call </span><span class="n">setFillPattern</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">call </span><span class="n">plcol1</span><span class="p">(</span> <span class="kt">real</span><span class="p">(</span> <span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">cb</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">cb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">cb</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">,</span><span class="n">pp</span><span class="p">)</span> <span class="p">)</span>
			<span class="k">call </span><span class="n">plfill</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">)</span>
			
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">lineColor</span><span class="p">)</span>
			<span class="k">call </span><span class="n">plline</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">)</span>
		<span class="k">end do</span>
<span class="k">		call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">bar</span>

	<span class="k">subroutine </span><span class="n">barh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">relWidth</span><span class="p">,</span><span class="n">fillColor</span><span class="p">,</span><span class="n">fillPattern</span><span class="p">,</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="c">!! Create a horizontal bar graph</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
			<span class="c">!! y-positions of the bars&#39; centers</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! x-positions of the bars&#39; tops</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">c</span>
			<span class="c">!! Color scale for bars</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">relWidth</span>
			<span class="c">!! Relative width of bars</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">fillColor</span>
			<span class="c">!! Color of bar fills</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">fillPattern</span>
			<span class="c">!! Pattern of bar fills</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineColor</span>
			<span class="c">!! Color of lines around bars</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineWidth</span>
			<span class="c">!! Width of lines around bars</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="kd">::</span><span class="n">cb</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span><span class="kd">::</span><span class="n">dy</span><span class="p">,</span><span class="n">dys</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">k</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="n">cb</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">mixval</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="n">pp</span><span class="p">)</span>
		<span class="n">dys</span> <span class="o">=</span> <span class="mf">0.8_pp</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">relWidth</span><span class="p">))</span> <span class="n">dys</span> <span class="o">=</span> <span class="kt">real</span><span class="p">(</span><span class="n">relWidth</span><span class="p">,</span><span class="n">pp</span><span class="p">)</span>
		<span class="n">dy</span> <span class="o">=</span> <span class="n">dys</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">pp</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0_pp</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		
		<span class="k">do </span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
			<span class="n">yl</span> <span class="o">=</span> <span class="kt">real</span><span class="p">([</span><span class="n">y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">dy</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">dy</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">dy</span><span class="p">,</span><span class="n">y</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">dy</span><span class="p">],</span><span class="n">pp</span><span class="p">)</span>
			<span class="n">xl</span> <span class="o">=</span> <span class="kt">real</span><span class="p">([</span><span class="mf">0.0_wp</span><span class="p">,</span><span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">x</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mf">0.0_wp</span><span class="p">],</span><span class="n">pp</span><span class="p">)</span>
			
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">fillColor</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">))</span> <span class="k">call </span><span class="n">setFillPattern</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">)</span>
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">call </span><span class="n">plcol1</span><span class="p">(</span> <span class="kt">real</span><span class="p">(</span> <span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">-</span><span class="n">cb</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">cb</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">cb</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">,</span><span class="n">pp</span><span class="p">)</span> <span class="p">)</span>
			<span class="k">call </span><span class="n">plfill</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">)</span>
			
			<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">lineColor</span><span class="p">)</span>
			<span class="k">call </span><span class="n">plline</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span><span class="p">)</span>
		<span class="k">end do</span>
<span class="k">		call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">barh</span>

	<span class="k">subroutine </span><span class="n">fillBetween</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">fillColor</span><span class="p">,</span><span class="n">fillPattern</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="c">!! Fill space between two lines</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y1</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">y0</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">fillColor</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">fillPattern</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineWidth</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">y1l</span><span class="p">,</span><span class="n">y0l</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">N</span>
		
		<span class="n">N</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		
		<span class="n">xl</span>  <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">y1l</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">y0</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			</span><span class="n">y0l</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y0</span><span class="p">)</span>
		<span class="k">else</span>
<span class="k">			allocate</span><span class="p">(</span><span class="n">y0l</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
			<span class="n">y0l</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">fillColor</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">))</span> <span class="k">call </span><span class="n">setFillPattern</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plfill</span><span class="p">([</span><span class="n">xl</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="p">:</span><span class="mi">1</span><span class="p">),</span><span class="n">xl</span><span class="p">(</span><span class="n">N</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">)],[</span><span class="n">y1l</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="p">:</span><span class="mi">1</span><span class="p">),</span><span class="n">y0l</span><span class="p">(</span><span class="n">N</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">fillBetween</span>

	<span class="k">subroutine </span><span class="n">fillBetweenx</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">fillColor</span><span class="p">,</span><span class="n">fillPattern</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="c">!! Fill space between two lines</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x1</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">x0</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">fillColor</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">fillPattern</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineWidth</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">yl</span><span class="p">,</span><span class="n">x1l</span><span class="p">,</span><span class="n">x0l</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">N</span>
		
		<span class="n">N</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
		
		<span class="n">yl</span>  <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
		<span class="n">x1l</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">x0</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			</span><span class="n">x0l</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
		<span class="k">else</span>
<span class="k">			allocate</span><span class="p">(</span><span class="n">x0l</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
			<span class="n">x0l</span> <span class="o">=</span> <span class="mf">0.0_pp</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">fillColor</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">))</span> <span class="k">call </span><span class="n">setFillPattern</span><span class="p">(</span><span class="n">fillPattern</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plfill</span><span class="p">([</span><span class="n">x1l</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="p">:</span><span class="mi">1</span><span class="p">),</span><span class="n">x0l</span><span class="p">(</span><span class="n">N</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">)],[</span><span class="n">yl</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">N</span><span class="p">:</span><span class="mi">1</span><span class="p">),</span><span class="n">yl</span><span class="p">(</span><span class="n">N</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">)])</span>
		<span class="k">call </span><span class="n">resetPen</span>
	<span class="k">end subroutine </span><span class="n">fillBetweenx</span>

	<span class="k">subroutine </span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xerr</span><span class="p">,</span><span class="n">yerr</span><span class="p">,</span><span class="n">lineColor</span><span class="p">,</span><span class="n">lineStyle</span><span class="p">,</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="c">!! Plot error bars for a set of data points</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">x</span>
			<span class="c">!! x-data for plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">y</span>
			<span class="c">!! y-data for plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">xerr</span>
			<span class="c">!! x-data error for plot</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">yerr</span>
			<span class="c">!! y-data error for plot</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineColor</span>
			<span class="c">!! Color of line</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineStyle</span>
			<span class="c">!! Style of line; &#39;&#39; for no line</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span><span class="kd">::</span><span class="n">lineWidth</span>
			<span class="c">!! Width of line</span>
		
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">xl</span><span class="p">,</span><span class="n">yl</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">xll</span><span class="p">,</span><span class="n">xlh</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">pp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="kd">::</span><span class="n">yll</span><span class="p">,</span><span class="n">ylh</span>
		
		<span class="n">xl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
		<span class="n">yl</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineColor</span><span class="p">))</span> <span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="n">lineColor</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">))</span> <span class="k">call </span><span class="n">setLineStyle</span><span class="p">(</span><span class="n">lineStyle</span><span class="p">)</span>
		
		<span class="k">if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">xerr</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			</span><span class="n">xll</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">xerr</span><span class="p">)</span>
			<span class="n">xlh</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">xerr</span><span class="p">)</span>
			<span class="k">call </span><span class="n">plerrx</span><span class="p">(</span><span class="n">xll</span><span class="p">,</span><span class="n">xlh</span><span class="p">,</span><span class="n">yl</span><span class="p">)</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		if</span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">yerr</span><span class="p">))</span> <span class="k">then</span>
<span class="k">			</span><span class="n">yll</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">yerr</span><span class="p">)</span>
			<span class="n">ylh</span> <span class="o">=</span> <span class="n">localize</span><span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">yerr</span><span class="p">)</span>
			<span class="k">call </span><span class="n">plerry</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span><span class="n">yll</span><span class="p">,</span><span class="n">ylh</span><span class="p">)</span>
		<span class="k">end if</span>
<span class="k">		</span>
<span class="k">		call </span><span class="n">resetPen</span>
	<span class="k">end subroutine</span>

	<span class="c">!========================!</span>
	<span class="c">!= Drawing Pen Routines =!</span>
	<span class="c">!========================!</span>

	<span class="k">subroutine </span><span class="n">resetPen</span>
		<span class="c">!! Reset pen to default state</span>
		
		<span class="k">call </span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
		<span class="k">call </span><span class="n">setLineStyle</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
		<span class="k">call </span><span class="n">setLineWidth</span><span class="p">(</span><span class="mf">0.5_wp</span><span class="p">)</span>
		<span class="k">call </span><span class="n">setFillPattern</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
		<span class="k">call </span><span class="n">plschr</span><span class="p">(</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">fontScale</span><span class="p">,</span><span class="n">pp</span><span class="p">))</span>
		<span class="k">call </span><span class="n">plssym</span><span class="p">(</span><span class="mf">0.0_pp</span><span class="p">,</span><span class="kt">real</span><span class="p">(</span><span class="n">fontScale</span><span class="p">,</span><span class="n">pp</span><span class="p">))</span>
	<span class="k">end subroutine </span><span class="n">resetPen</span>

	<span class="k">subroutine </span><span class="n">setLineWidth</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">)</span>
		<span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">lineWidth</span>
		
		<span class="k">call </span><span class="n">plwidth</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">lineWidth</span><span class="p">,</span><span class="n">pp</span><span class="p">))</span>
	<span class="k">end subroutine </span><span class="n">setLineWidth</span>

	<span class="k">subroutine </span><span class="n">setLineStyle</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
		<span class="c">!! Set the current pen line style</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">style</span>
			<span class="c">!! Style to set</span>
		
		<span class="k">call </span><span class="n">pllsty</span><span class="p">(</span><span class="n">getLineStyleCode</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>
	<span class="k">end subroutine </span><span class="n">setLineStyle</span>

	<span class="k">function </span><span class="n">getLineStyleCode</span><span class="p">(</span><span class="n">style</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
		<span class="c">!! Return the code for a line style</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">style</span>
			<span class="c">!! Style desired</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">code</span>
		
		<span class="k">select case</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="mi">3</span>
		<span class="k">case </span><span class="n">default</span>
			<span class="n">code</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">end select</span>
<span class="k">	end function </span><span class="n">getLineStyleCode</span>

	<span class="k">function </span><span class="n">getSymbolCode</span><span class="p">(</span><span class="n">style</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
		<span class="c">!! Return the code for a symbol style</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">style</span>
			<span class="c">!! Style desired</span>
		<span class="kt">character</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="kd">::</span><span class="n">code</span>
		
		<span class="k">select case</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;#(140)&#39;</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;#(141)&#39;</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;#(142)&#39;</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;#(143)&#39;</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;#(144)&#39;</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;#(850)&#39;</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;#(852)&#39;</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;#(853)&#39;</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;#(854)&#39;</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;#(855)&#39;</span>
		<span class="k">case </span><span class="n">default</span>
			<span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;#(143)&#39;</span>
		<span class="k">end select</span>
<span class="k">	end function </span><span class="n">getSymbolCode</span>

	<span class="k">subroutine </span><span class="n">setFillPattern</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">style</span>
		
		<span class="k">call </span><span class="n">plpsty</span><span class="p">(</span><span class="n">getFillCode</span><span class="p">(</span><span class="n">style</span><span class="p">))</span>
	<span class="k">end subroutine </span><span class="n">setFillPattern</span>

	<span class="k">function </span><span class="n">getFillCode</span><span class="p">(</span><span class="n">style</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
		<span class="kt">character</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span><span class="n">style</span>
		<span class="kt">integer</span><span class="kd">::</span><span class="n">code</span>
		
		<span class="k">select case</span><span class="p">(</span><span class="n">style</span><span class="p">)</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="mi">0</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="mi">3</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
			<span class="n">code</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="k">case</span><span class="p">(</span><span class="s1">&#39;\&#39;)</span>
<span class="s1">			code = 4</span>
<span class="s1">		case(&#39;</span><span class="err">#</span><span class="s1">&#39;)</span>
<span class="s1">			code = 7</span>
<span class="s1">		case(&#39;</span><span class="n">x</span><span class="s1">&#39;)</span>
<span class="s1">			code = 8</span>
<span class="s1">		case default</span>
<span class="s1">			code = 0</span>
<span class="s1">		end select</span>
<span class="s1">	end function getFillCode</span>

<span class="s1">	subroutine setColor(color)</span>
<span class="s1">		!! Set the current pen color</span>
<span class="s1">		character(*),intent(in)::color</span>
<span class="s1">			!! Name of color to set</span>
<span class="s1">		</span>
<span class="s1">		integer::ios</span>
<span class="s1">		real(pp)::v</span>
<span class="s1">		</span>
<span class="s1">		read(color,*,iostat=ios) v</span>
<span class="s1">		if(ios==0) then</span>
<span class="s1">			call plcol1(v)</span>
<span class="s1">		else</span>
<span class="s1">			call plcol0(getColorCode(color))</span>
<span class="s1">		end if</span>
<span class="s1">	end subroutine setColor</span>

<span class="s1">	function getColorCode(color) result(code)</span>
<span class="s1">		character(*),intent(in)::color</span>
<span class="s1">		integer::code</span>
<span class="s1">		</span>
<span class="s1">		select case(color)</span>
<span class="s1">		case(&#39;</span><span class="n">w</span><span class="s1">&#39;,&#39;</span><span class="n">white</span><span class="s1">&#39;)</span>
<span class="s1">			if(blackOnWhite) then</span>
<span class="s1">				code = 1</span>
<span class="s1">			else</span>
<span class="s1">				code = 2</span>
<span class="s1">			end if</span>
<span class="s1">		case(&#39;</span><span class="n">k</span><span class="s1">&#39;,&#39;</span><span class="n">black</span><span class="s1">&#39;)</span>
<span class="s1">			if(blackOnWhite) then</span>
<span class="s1">				code = 2</span>
<span class="s1">			else</span>
<span class="s1">				code = 1</span>
<span class="s1">			end if</span>
<span class="s1">		case(&#39;</span><span class="n">r</span><span class="s1">&#39;,&#39;</span><span class="n">red</span><span class="s1">&#39;)</span>
<span class="s1">			code = 3</span>
<span class="s1">		case(&#39;</span><span class="n">g</span><span class="s1">&#39;,&#39;</span><span class="n">green</span><span class="s1">&#39;)</span>
<span class="s1">			code = 4</span>
<span class="s1">		case(&#39;</span><span class="n">b</span><span class="s1">&#39;,&#39;</span><span class="n">blue</span><span class="s1">&#39;)</span>
<span class="s1">			code= 5</span>
<span class="s1">		case(&#39;</span><span class="n">c</span><span class="s1">&#39;,&#39;</span><span class="n">cyan</span><span class="s1">&#39;)</span>
<span class="s1">			code = 6</span>
<span class="s1">		case(&#39;</span><span class="n">m</span><span class="s1">&#39;,&#39;</span><span class="n">magenta</span><span class="s1">&#39;)</span>
<span class="s1">			code= 7</span>
<span class="s1">		case(&#39;</span><span class="n">y</span><span class="s1">&#39;,&#39;</span><span class="n">yellow</span><span class="s1">&#39;)</span>
<span class="s1">			code = 8</span>
<span class="s1">		case(&#39;</span><span class="n">fg</span><span class="s1">&#39;)</span>
<span class="s1">			code = 2</span>
<span class="s1">		case(&#39;</span><span class="n">bg</span><span class="s1">&#39;)</span>
<span class="s1">			code = 1</span>
<span class="s1">		case default</span>
<span class="s1">			code = 2</span>
<span class="s1">		end select</span>
<span class="s1">		</span>
<span class="s1">		code = code-1</span>
<span class="s1">	end function getColorCode</span>

<span class="s1">	!===========================!</span>
<span class="s1">	!= Library Status Routines =!</span>
<span class="s1">	!===========================!</span>

<span class="s1">	subroutine setup(device,fileName,fontScaling,whiteOnBlack,transparent,colormap,figSize)</span>
<span class="s1">		!! Setup PlPlot library, optionally overriding defaults</span>
<span class="s1">		character(*),intent(in),optional::device</span>
<span class="s1">			!! Output device to use</span>
<span class="s1">			!!</span>
<span class="s1">			!! * qtwidget</span>
<span class="s1">			!! * svgqt</span>
<span class="s1">			!! * pngqt</span>
<span class="s1">		character(*),intent(in),optional::fileName</span>
<span class="s1">			!! Name of file(s) to write to</span>
<span class="s1">			!! </span>
<span class="s1">			!! The text `%n` will be replaced with the figure number</span>
<span class="s1">		real(wp),intent(in),optional::fontScaling</span>
<span class="s1">			!! Font scaling relative to default value</span>
<span class="s1">		logical,intent(in),optional::whiteOnBlack</span>
<span class="s1">			!! Default foreground and background colors</span>
<span class="s1">		logical,intent(in),optional::transparent</span>
<span class="s1">			!! Transparent background</span>
<span class="s1">		character(*),intent(in),optional::colormap</span>
<span class="s1">			!! Colormap to use</span>
<span class="s1">		integer,dimension(2),intent(in),optional::figSize</span>
<span class="s1">			!! Size of figures to produce in pixels</span>
<span class="s1">		</span>
<span class="s1">		character(64)::bufx,bufy</span>
<span class="s1">		</span>
<span class="s1">		if(isSetup) return</span>
<span class="s1">		isSetup = .true.</span>
<span class="s1">		</span>
<span class="s1">		if(present(device)) then</span>
<span class="s1">			call plsdev(device)</span>
<span class="s1">		else</span>
<span class="s1">			call plsdev(default_dev)</span>
<span class="s1">		end if</span>
<span class="s1">		</span>
<span class="s1">		call plsfam(1,1,100)</span>
<span class="s1">		if(present(fileName)) then</span>
<span class="s1">			call plsfnam(fileName)</span>
<span class="s1">		else</span>
<span class="s1">			call plsfnam(&#39;</span><span class="n">out</span><span class="s1">&#39;)</span>
<span class="s1">		end if</span>
<span class="s1">		</span>
<span class="s1">		if(present(whiteOnBlack)) blackOnWhite = .not. whiteOnBlack</span>
<span class="s1">		</span>
<span class="s1">		if(present(transparent)) transparentBackground = transparent</span>
<span class="s1">		</span>
<span class="s1">		call setIndexedColors</span>
<span class="s1">		</span>
<span class="s1">		if(present(colormap)) then</span>
<span class="s1">			call setColormap(colormap)</span>
<span class="s1">		else</span>
<span class="s1">			call setColormap(&#39;</span><span class="n">CoolWarm</span><span class="s1">&#39;)</span>
<span class="s1">		end if</span>
<span class="s1">		</span>
<span class="s1">		call plfontld(0)</span>
<span class="s1">		if(present(fontScaling)) fontScale = real(fontScaling,pp)</span>
<span class="s1">		</span>
<span class="s1">		if(present(figSize)) then</span>
<span class="s1">			write(bufx,*) figSize(1)</span>
<span class="s1">			write(bufy,*) figSize(2)</span>
<span class="s1">			call plsetopt(&#39;</span><span class="n">geometry</span><span class="s1">&#39;,trim(adjustl(bufx))//&#39;</span><span class="n">x</span><span class="s1">&#39;//trim(adjustl(bufy)))</span>
<span class="s1">		else</span>
<span class="s1">			call plsetopt(&#39;</span><span class="n">geometry</span><span class="s1">&#39;,&#39;</span><span class="mi">640</span><span class="n">x480</span><span class="s1">&#39;)</span>
<span class="s1">		end if</span>
<span class="s1">		</span>
<span class="s1">		call plinit</span>
<span class="s1">		</span>
<span class="s1">		call resetPen</span>
<span class="s1">	end subroutine setup</span>

<span class="s1">	subroutine show</span>
<span class="s1">		!! Show the plots end finialize the PlPlot library</span>
<span class="s1">		if(.not.didShow) then</span>
<span class="s1">			call plend</span>
<span class="s1">			didShow = .true.</span>
<span class="s1">		end if</span>
<span class="s1">	end subroutine show</span>

<span class="s1">	!======================!</span>
<span class="s1">	!= Color Map Routines =!</span>
<span class="s1">	!======================!</span>

<span class="s1">	subroutine setIndexedColors</span>
<span class="s1">		!! Setup the indexed colors</span>
<span class="s1">		integer,dimension(8,3)::rgb</span>
<span class="s1">		real(plflt),dimension(8)::a</span>
<span class="s1">		</span>
<span class="s1">		rgb(getColorCode(&#39;</span><span class="n">w</span><span class="s1">&#39;)+1,:) = [255,255,255] ! White</span>
<span class="s1">		rgb(getColorCode(&#39;</span><span class="n">k</span><span class="s1">&#39;)+1,:) = [  0,  0,  0] ! Black</span>
<span class="s1">		rgb(getColorCode(&#39;</span><span class="n">r</span><span class="s1">&#39;)+1,:) = [255,  0,  0] ! Red</span>
<span class="s1">		rgb(getColorCode(&#39;</span><span class="n">g</span><span class="s1">&#39;)+1,:) = [  0,255,  0] ! Green</span>
<span class="s1">		rgb(getColorCode(&#39;</span><span class="n">b</span><span class="s1">&#39;)+1,:) = [  0,  0,255] ! Blue</span>
<span class="s1">		rgb(getColorCode(&#39;</span><span class="n">c</span><span class="s1">&#39;)+1,:) = [  0,255,255] ! Cyan</span>
<span class="s1">		rgb(getColorCode(&#39;</span><span class="n">m</span><span class="s1">&#39;)+1,:) = [255,  0,255] ! Magenta</span>
<span class="s1">		rgb(getColorCode(&#39;</span><span class="n">y</span><span class="s1">&#39;)+1,:) = [255,255,  0] ! Yellow</span>
<span class="s1">		</span>
<span class="s1">		a = 1.0_plflt</span>
<span class="s1">		if(transparentBackground) a(1) = 0.0_wp</span>
<span class="s1">		</span>
<span class="s1">		call plscmap0a(rgb(:,1),rgb(:,2),rgb(:,3),a)</span>
<span class="s1">	end subroutine setIndexedColors</span>

<span class="s1">	subroutine setColormap(colormap)</span>
<span class="s1">		!! Set the continuous colormap</span>
<span class="s1">		character(*),intent(in)::colormap</span>
<span class="s1">			!! Name of colormap to use</span>
<span class="s1">		</span>
<span class="s1">		real(pp),dimension(:),allocatable::i,h,s,v</span>
<span class="s1">		</span>
<span class="s1">		select case(colormap)</span>
<span class="s1">		case(&#39;</span><span class="n">CoolWarm</span><span class="s1">&#39;)</span>
<span class="s1">			h = [240.0,195.0,45.0,0.0]</span>
<span class="s1">			</span>
<span class="s1">			s = [0.60, 0.95, 0.95, 0.60]</span>
<span class="s1">			v = [0.80, 0.30, 0.30, 0.80]</span>
<span class="s1">			i = [0.00, 0.50, 0.50, 1.00]</span>
<span class="s1">			</span>
<span class="s1">			call plscmap1n(256)</span>
<span class="s1">			call plscmap1l(.false.,i,h,s,v)</span>
<span class="s1">		case(&#39;</span><span class="n">Gray</span><span class="s1">&#39;)</span>
<span class="s1">			call plspal1(&#39;</span><span class="n">cmap1_gray</span><span class="p">.</span><span class="n">pal</span><span class="s1">&#39;,1)</span>
<span class="s1">		case(&#39;</span><span class="n">BlueYellow</span><span class="s1">&#39;)</span>
<span class="s1">			call plspal1(&#39;</span><span class="n">cmap1_blue_yellow</span><span class="p">.</span><span class="n">pal</span><span class="s1">&#39;,1)</span>
<span class="s1">		case(&#39;</span><span class="n">BlueRed</span><span class="s1">&#39;)</span>
<span class="s1">			call plspal1(&#39;</span><span class="n">cmap1_blue_red</span><span class="p">.</span><span class="n">pal</span><span class="s1">&#39;,1)</span>
<span class="s1">		case(&#39;</span><span class="n">Radar</span><span class="s1">&#39;)</span>
<span class="s1">			call plspal1(&#39;</span><span class="n">cmap1_radar</span><span class="p">.</span><span class="n">pal</span><span class="s1">&#39;,1)</span>
<span class="s1">		case(&#39;</span><span class="n">HighFreq</span><span class="s1">&#39;)</span>
<span class="s1">			call plspal1(&#39;</span><span class="n">cmap1_highfreq</span><span class="p">.</span><span class="n">pal</span><span class="s1">&#39;,1)</span>
<span class="s1">		case(&#39;</span><span class="n">LowFreq</span><span class="s1">&#39;)</span>
<span class="s1">			call plspal1(&#39;</span><span class="n">cmap1_lowfreq</span><span class="p">.</span><span class="n">pal</span><span class="err">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">end select</span>
<span class="k">	end subroutine </span><span class="n">setColormap</span>

<span class="k">end module </span><span class="n">plplotlib_mod</span>
</pre></div>

    </section>
    </div>
  </div>

    <hr>
    <footer>
        <div class="row">
        <div class="col-md-6">&copy; 2015 PlPlotLib was written by Dr Kyle Horne. </div>
        <div class="col-md-6"><span class="pull-right">Documentation generated by <a href="https://github.com/cmacmackin/ford">FORD</a>.</span></div>
        </div>
        <br>
    </footer>
    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>